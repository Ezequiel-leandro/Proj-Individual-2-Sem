<!DOCTYPE html>
<!-- 
* CoreUI - Free Bootstrap Admin Template
* @version v4.2.1
* @link https://coreui.io
* Copyright (c) 2022 creativeLabs Łukasz Holeczek
* Licensed under MIT (https://coreui.io/license)
-->
<!-- Breadcrumb -->
<html lang="en">

<head>
  <base href="./">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
  <meta name="author" content="Łukasz Holeczek">
  <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
  <title>Gráficos | REC.</title>
  <link rel="apple-touch-icon" sizes="57x57" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="60x60" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="72x72" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="76x76" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="114x114" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="120x120" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="144x144" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/favicon.jpg">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/favicon.jpg">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/favicon.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon.jpg">
  <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon">
  <!-- <link rel="manifest" href="assets/favicon/manifest.json"> -->
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="assets/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <!-- Vendors styles-->
  <link rel="stylesheet" href="vendors/simplebar/css/simplebar.css">
  <link rel="stylesheet" href="css/vendors/simplebar.css">
  <!-- Main styles for this application-->
  <link href="css/style2.css" rel="stylesheet">
  <!-- We use those styles to show code examples, you should remove them in your application.-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css">
  <link href="css/examples.css" rel="stylesheet">
  <!-- Global site tag (gtag.js) - Google Analytics-->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118965717-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    // Shared ID
    gtag('config', 'UA-118965717-3');
    // Bootstrap ID
    gtag('config', 'UA-118965717-5');
  </script>
  <link href="vendors/@coreui/chartjs/css/coreui-chartjs.css" rel="stylesheet">
</head>
<style>
  body {
    background-color: #e9eaef;
    font-family: Helvetica, Arial;
  }

  h2 {
    color: #999;
    font-weight: 400;
    font-size: 18px;
    margin-bottom: 15px;
  }

  .container {
    max-width: 1000px;
    margin: 20px auto;
    padding: 15px;
    background-color: #fff;
    border-radius: 10px;
  }

  .container table {
    border: 1px solid #d6d6d6;
    border-collapse: collapse;
    width: 100%;
    background-color: #fff;
  }

  .container table thead {
    background-color: #ffffff;
    border: 1px solid #d6d6d6;
    border-bottom: none;
  }

  .container table thead th {
    text-transform: capitalize;
    border-right: 1px solid #d6d6d6;
    background-color: #f5f5f5;
    font-size: 12px;
    font-weight: 600;
  }

  .container table thead th:last-child {
    border-right: none;
  }

  .container table thead th a {
    position: relative;
    text-decoration: none;
    color: #8693d3;
    display: block;
    padding: 10px;
    font-size: 12px;
    font-weight: 600;
    text-align: left;
    padding-right: 25px;
  }

  .container table thead th a:hover,
  .container table thead th a:focus {
    background-color: #e2e2e4;
  }

  .container table thead th.ascendent_sort,
  .container table thead th.descendent_sort {
    background-color: #e3edfd;
  }

  .container table thead th.ascendent_sort a:hover,
  .container table thead th.ascendent_sort a:focus,
  .container table thead th.descendent_sort a:hover,
  .container table thead th.descendent_sort a:focus {
    background-color: transparent;
  }

  .container table thead th.ascendent_sort a:before,
  .container table thead th.descendent_sort a:before {
    content: '';
    position: absolute;
    right: 10px;
    top: 50%;
    border: 5px solid transparent;
  }

  .container table thead th.ascendent_sort a:before {
    border-bottom-color: #3F51B5;
    margin-top: -7px;
  }

  .container table thead th.descendent_sort a:before {
    border-top-color: #3F51B5;
    margin-top: -2px;
  }

  .container table tbody tr {
    border-top: 1px solid #d6d6d6;
  }

  .container table tbody td {
    border-right: 1px solid #d6d6d6;
    font-size: 12px;
    padding: 10px;
  }

  .container table tbody td:last-child {
    border-right: none;
  }

  .responsive-table {
    overflow: auto;
    border-right: 1px solid #d6d6d6;
    border-left: 1px solid #d6d6d6;
  }

  .btn {
    display: inline-block;
    border: none;
    padding: 5px;
    margin-top: 10px;
    background-color: #2196F3;
    color: #fff;
    cursor: pointer;
  }

  .btn:hover,
  .btn:focus {
    background-color: #1772b3
  }

  .loading {
    display: block;
    text-align: center;
    padding: 20px;
    font-size: 12px;
  }

  .custom-data {
    border-top: 1px solid #ccc;
    margin-top: 10px;
    padding-top: 10px;
  }

  .custom-data textarea {
    display: block;
    width: 100%;
    max-width: 100%;
    min-width: 100%;
    min-height: 100px;
  }
</style>

<body>
  <div class="sidebar sidebar-dark sidebar-fixed" id="sidebar">
    <div class="sidebar-brand d-none d-md-flex">
      <div class="sidebar-brand-full" width="118" height="46" alt="CoreUI Logo">
        <img src="assets/brand/favicon.png " alt="" style="height: 70" width="170">
      </div>
      <svg class="sidebar-brand-narrow" width="46" height="46" alt="CoreUI Logo">
        <use xlink:href="assets/brand/coreui.svg#signet"></use>
      </svg>
    </div>
    <ul class="sidebar-nav" data-coreui="navigation" data-simplebar="">
      <li class="nav-title">Componentes</li>
      <li class="nav-group"><a class="nav-link nav-group-toggle" href="#">
          <svg class="nav-icon">
            <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-puzzle"></use>
          </svg>Dashboards</a>
        <ul class="nav-group-items">
          <li class="nav-item"><a class="nav-link" href="index.html"><span class="nav-icon"></span>Dashboard Inicial</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="dash-gerente-matriz.html"><span
                class="nav-icon"></span>Gerente(Matriz)</a></li>
          <li class="nav-item"><a class="nav-link" href="dash-gerente-filial.html"><span
                class="nav-icon"></span>Gerente(Filial)</a></li>
          <li class="nav-item"><a class="nav-link" href="dash-analista.html"><span
                class="nav-icon"></span>Analista(Filial)</a></li>
          <li class="nav-item"><a class="nav-link" href="dash-tecnico.html"><span
                class="nav-icon"></span>Tecnico(Filial)</a></li>
        </ul>
      </li>
      <li class="nav-title">Cadastro</li>
      <li class="nav-group"><a class="nav-link nav-group-toggle" href="#">
          <svg class="nav-icon">
            <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-star"></use>
          </svg> Opções</a>
        <ul class="nav-group-items">
          <li class="nav-item"><a class="nav-link" href="../sala.html" target="_top">
              <svg class="nav-icon">
                <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-account-logout"></use>
              </svg> Cadastro de sala</a></li>
      </li>
      </a></li>
    </ul>
    <button class="sidebar-toggler" type="button" data-coreui-toggle="unfoldable"></button>
  </div>
  <div class="wrapper d-flex flex-column min-vh-100 bg-light">
    <header class="header header-sticky mb-4">
      <div class="container-fluid">

        <svg width="118" height="46" alt="CoreUI Logo">
          <use xlink:href="assets/brand/coreui.svg#full"></use>
        </svg>
        <h2>Dashboard | Gerente Matriz</h2></a>

        <ul class="header-nav ms-3">
          <li class="nav-item dropdown"><a class="nav-link py-0" data-coreui-toggle="dropdown" href="#" role="button"
              aria-haspopup="true" aria-expanded="false">
              <div class="avatar avatar-md"><img class="avatar-img" src="assets/img/avatars/fernando.jfif"
                  alt="user@email.com"></div>
            </a>
            <div class="dropdown-menu dropdown-menu-end pt-0">
              <div class="dropdown-header bg-light py-2">
                <div class="fw-semibold">Conta</div>
              </div><a class="dropdown-item" href="#">
                <svg class="icon me-2">
                  <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-bell"></use>
                </svg> Atualizações<span class="badge badge-sm bg-info ms-2">42</span></a><a class="dropdown-item"
                href="#">
                <svg class="icon me-2">
                  <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-envelope-open"></use>
                </svg> Mensagens<span class="badge badge-sm bg-success ms-2">42</span></a><a class="dropdown-item"
                href="#">

                <div class="dropdown-header bg-light py-2">
                  <div class="fw-semibold">Modificações</div>
                </div><a class="dropdown-item" href="#">
                  <svg class="icon me-2">
                    <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-user"></use>
                  </svg> Perfil</a><a class="dropdown-item" href="#">
                  <svg class="icon me-2">
                    <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-settings"></use>
                  </svg> Configurações</a><a href="#">
                  <ul class="icon me-2">
                    <a class="nav-link" href="../login.html"></svg> Sair</a>
            </div>
          </li>
        </ul>
      </div>
      <div class="header-divider"></div>
      <div class="container-fluid">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb my-0 ms-2">
            <li class="breadcrumb-item">
              <!-- if breadcrumb is single--><span>Início</span>
            </li>
          </ol>
        </nav>
      </div>
    </header>
    <div class="body flex-grow-1 px-3">
      <div class="container-lg">
        <div class="row">
          <div class="col-sm-6 col-lg-3">
          </div>
          <!-- /.col-->
          <!-- /.col-->
          <!-- /.col-->
          <!-- /.col-->
        </div>
        <!-- /.row-->
        <div class="qtd-maq">
          <h3>Quantidade de chamados no Atm</h3>
        </div>
      </div>

      <div class="chamados1">
        <canvas id="chartChamados"></canvas>
      </div>

      <div class="container">
        <div class="responsive-table">
          <div id="dynamic-table"></div>
        </div>
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="vendors/@coreui/coreui/js/coreui.bundle.min.js"></script>
    <script src="vendors/simplebar/js/simplebar.min.js"></script>
    <!-- Plugins and scripts required by this view-->
    <script src="vendors/chart.js/js/chart.min.js"></script>
    <script src="vendors/@coreui/chartjs/js/coreui-chartjs.js"></script>
    <script src="vendors/@coreui/utils/js/coreui-utils.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
<script>

  vetor_Atm = []

  fetch("/usuarios/listarAtm", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      fkFilialServer: sessionStorage.ID_FILIAL,
    })
  }).then(function (resposta) {
    console.log("ESTOU NO THEN DO entrar()!")

    if (resposta.ok) {
      console.log(resposta);

      resposta.json().then(json => {
        // console.log(json);
        // console.log(JSON.stringify(json));
        json.forEach(element => {
          vetor_Atm.push(element.idAtm)
        });
        console.log(vetor_Atm)
      });


    } else {

      console.log("Houve um erro ao tentar realizar o login!");
    }

  }).catch(function (erro) {
    console.log(erro);
  })



</script>
<!-- GRAFICO ALERTAS -->
<script>
  var vetor_alerta = []
  var vetor_emergencial = []
  var vetor_critico = []
  // var fkAtm = 1

  listarCriticidade('Alerta')
  listarCriticidade('Emergencial')
  listarCriticidade('Critico')
  setTimeout(() => plotarGraficoChamado(), 3000);
  setTimeout(() => createTable(), 3000);


  function listarCriticidade(criticidade) {

    fetch("/usuarios/listarCriticidade", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        criticidadeServer: criticidade,
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO entrar()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          // console.log(json);
          // console.log(JSON.stringify(json));
          json.forEach(element => {
            if (criticidade == 'Alerta') {
              vetor_alerta.push(element)
            } else if (criticidade == 'Emergencial') {
              vetor_emergencial.push(element)
            } else if (criticidade == 'Critico') {
              vetor_critico.push(element)
            }
          });
        });


      } else {

        console.log("Houve um erro ao tentar realizar o login!");
      }

    }).catch(function (erro) {
      console.log(erro);
    })
  }

  function plotarGraficoChamado() {
    var numAlerta = vetor_alerta.length
    var numEmergencial = vetor_emergencial.length
    var numCritico = vetor_critico.length
    const labels = ['Alerta', 'Emergencial', 'Critico']
    const data = {
      labels: labels,
      datasets: [{
        label: 'Chamados',
        data: [numAlerta, numEmergencial, numCritico],
        backgroundColor: [
          'rgb(0, 0, 255)',
          'rgb(0, 128, 255)',
          'rgb(0, 191, 255)'
        ],
        borderColor: [
          'rgb(0, 0, 0)',
          'rgb(0, 0, 0)',
          'rgb(0, 0, 0)'
        ],
        borderWidth: 1
      }]
    };
    const config = {
      type: 'bar',
      data: data,
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
    };
    const myChart = new Chart(
      document.getElementById('chartChamados'),
      config
    );
  }

</script>



<!-- TABELA USUARIOS -->
<script>
  fetch("/usuarios/listaUsuarios", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      fkFilialServer: sessionStorage.ID_FILIAL,
    })

  }).then(function (resposta) {
    console.log(resposta)

    if (resposta.ok) {
      resposta.json().then(json => {
        console.log(json);
        json.forEach(element => {
          firstFile.push(element)
        });
      });


    } else {

      console.log("aaaaaaaaaaaaaaaaa!");
    }

  }).catch(function (erro) {
    console.log(erro);
  })


  var firstFile = [];


  function createTable() {
    console.log('aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa')
    var divId = 'dynamic-table';
    var div = document.getElementById(divId);


    div.innerHTML = '<span class="loading">Loading...</span>';

    setTimeout(() => {
      div.innerHTML = '';

      var tableId = 'sortable';
      var json = firstFile;
      var table = new DynamicTable(tableId, json);
      div.appendChild(table);

      new SortableTable(tableId);
    }, 500);
  }

  function createTableWithData() {
    var divId = 'dynamic-table';
    var div = document.getElementById(divId);

    div.innerHTML = '<span class="loading">Loading...</span>';

    setTimeout(() => {
      div.innerHTML = '';

      var tableId = 'sortable';
      var json = document.getElementById('customData').value.trim() || '[]';

      try {
        json = JSON.parse(json);

        if (json.length > 0) {
          var table = new DynamicTable(tableId, json);
          div.appendChild(table);

          new SortableTable(tableId);
        } else {
          div.innerHTML = 'Empty collection of data detected';
        }
      } catch (error) {
        div.innerHTML = 'Invalid data. Please validate your data first.';
      }
    }, 100);
  }



  /**
   * *******************************************************************
   * **************************** SOLUTION ****************************
   * *******************************************************************
   */

  /**
   * *******************************************************************
   * HELPERS: helper functions I use in the solutions
   * *******************************************************************
   */

  // Sort helper
  function sortFn(a, b) {
    if (a.value < b.value) {
      return -1;
    }

    if (a.value > b.value) {
      return 1;
    }

    return 0;
  }

  // Sort the list
  function sortList(list, direction) {
    var sorted = list.sort(sortFn);

    if (direction === -1) {
      list.reverse();
    }

    return sorted;
  }

  // Event triggered on heading anchor click (which will trigger the sort)
  function onHeadigClick(that, cellIndex) {
    return function () {
      that.sortColumn(this, cellIndex);

      return false;
    };
  }

  // Create anchor for each th
  function createAnchor(html, index) {
    var a = document.createElement('a');
    a.href = '#';
    a.innerHTML = html;
    a.onclick = onHeadigClick(this, index);

    return a;
  }

  /**
   * *******************************************************************
   * TASKS: from here are the real task solutions
   * *******************************************************************
   */

  /**
   * Solution for task A. Generate a table with dymanic headers based on the data
   * @param {string} id the id the table will have
   * @param {array} data json data
   *
   * @return {HTMLElement} resulting table
   */
  function DynamicTable(tableId, data) {
    var headings = data.reduce(function (result, item) {
      var item_headings = Object.keys(item);

      item_headings.forEach(function (heading) {
        if (result.indexOf(heading) === -1) {
          result.push(heading);
        }
      });

      return result;
    }, []);

    var table = document.createElement('table');
    var thead = document.createElement('thead');
    var tbody = document.createElement('tbody');
    var thead_tr = document.createElement('tr');

    headings.forEach(function (heading) {
      var cell = document.createElement('th');
      cell.innerHTML = heading;

      thead_tr.appendChild(cell);
    });

    data.forEach(function (item) {
      var tbody_tr = document.createElement('tr');

      headings.forEach(function (heading) {
        var cell = document.createElement('td');
        cell.innerHTML = item[heading] || '';

        tbody_tr.appendChild(cell);
      });

      tbody.appendChild(tbody_tr);
    });

    thead.appendChild(thead_tr);
    table.appendChild(thead);
    table.appendChild(tbody);
    table.id = tableId;

    return table;
  }

  /**
   * Solution for task B. reate a new instance of sortableTable tied to a table
   * @param {string} id table id
   */
  function SortableTable(id) {
    this.table = document.getElementById(id);
    this.lastSortedTh = null;

    if (this.table && this.table.nodeName === 'TABLE') {
      var headings = this.table.tHead.rows[0].cells;

      Object.assign([], headings).forEach(
        function (heading, index) {
          if (heading.className.match(/ascendent_sort|descendent_sort/)) {
            this.lastSortedTh = heading;
          }
        }.bind(this),
      );

      this.setTableSortable();
    }
  }

  SortableTable.prototype.setTableSortable = function () {
    var headings = this.table.tHead.rows[0].cells;

    Object.assign([], headings).forEach(
      function (heading, index) {
        var sortAnchor = createAnchor.bind(this);
        var html = heading.innerHTML;
        heading.innerHTML = '';
        heading.appendChild(sortAnchor(html, index));
      }.bind(this),
    );
  };

  SortableTable.prototype.sortColumn = function (el, cellIndex) {
    var tBody = this.table.tBodies[0];
    var rows = this.table.rows;
    var th = el.parentNode;
    var list = [];

    Object.assign([], rows).forEach(function (row, index) {
      if (index > 0) {
        var cell = row.cells[cellIndex];
        var content = cell.textContent || cell.innerText;

        list.push({
          value: content,
          row: row,
        });
      }
    });

    var hasAscendentClassName = th.className.match('ascendent_sort');
    var hasDescendentClassName = th.className.match('descendent_sort');

    list = sortList(list, hasAscendentClassName ? -1 : 1);

    if (hasAscendentClassName) {
      th.className = th.className.replace(/ascendent_sort/, 'descendent_sort');
    } else {
      if (hasDescendentClassName) {
        th.className = th.className.replace(/descendent_sort/, 'ascendent_sort');
      } else {
        th.className += 'ascendent_sort';
      }
    }

    if (this.lastSortedTh && th !== this.lastSortedTh) {
      this.lastSortedTh.className = this.lastSortedTh.className.replace(
        /descendent_sort|ascendent_sort/g,
        '',
      );
    }

    this.lastSortedTh = th;

    list.forEach(function (item, index) {
      tBody.appendChild(item.row);
    });
  };
</script>